# typed: false
# frozen_string_literal: true

# This file was generated by GoReleaser. DO NOT EDIT.
class ClaudeDashboard < Formula
  desc "k9s-style TUI for managing Claude Code sessions"
  homepage "https://github.com/seunggabi/claude-dashboard"
  version "0.9.3"
  license "MIT"

  on_macos do
    if Hardware::CPU.intel?
      url "https://github.com/seunggabi/claude-dashboard/releases/download/v0.9.3/claude-dashboard_0.9.3_darwin_amd64.tar.gz"
      sha256 "364b4ef6d2a5f87d901f6d47ff9483660ffa40d32f63c2fe330f76c6b25c7392"

      def install
        bin.install "claude-dashboard"
        # Install helper scripts to a temporary location for setup to use
        libexec.install "scripts/tmux-mouse-toggle.sh"
        libexec.install "scripts/tmux-status-bar.sh"
      end
    end
    if Hardware::CPU.arm?
      url "https://github.com/seunggabi/claude-dashboard/releases/download/v0.9.3/claude-dashboard_0.9.3_darwin_arm64.tar.gz"
      sha256 "ee10d340a7936fa5be128baf9927832a2303fd8a9e7698762f09d7822ba6d75d"

      def install
        bin.install "claude-dashboard"
        # Install helper scripts to a temporary location for setup to use
        libexec.install "scripts/tmux-mouse-toggle.sh"
        libexec.install "scripts/tmux-status-bar.sh"
      end
    end
  end

  on_linux do
    if Hardware::CPU.intel? && Hardware::CPU.is_64_bit?
      url "https://github.com/seunggabi/claude-dashboard/releases/download/v0.9.3/claude-dashboard_0.9.3_linux_amd64.tar.gz"
      sha256 "2072be56ea04308af7ad013132a947a9c6962a762e0b2f437ce100cd6b8cd008"
      def install
        bin.install "claude-dashboard"
        # Install helper scripts to a temporary location for setup to use
        libexec.install "scripts/tmux-mouse-toggle.sh"
        libexec.install "scripts/tmux-status-bar.sh"
      end
    end
    if Hardware::CPU.arm? && Hardware::CPU.is_64_bit?
      url "https://github.com/seunggabi/claude-dashboard/releases/download/v0.9.3/claude-dashboard_0.9.3_linux_arm64.tar.gz"
      sha256 "4059eb084f29a201ffbf4e450117fc2efe057eff5492ba2f55af82c1e50b6514"
      def install
        bin.install "claude-dashboard"
        # Install helper scripts to a temporary location for setup to use
        libexec.install "scripts/tmux-mouse-toggle.sh"
        libexec.install "scripts/tmux-status-bar.sh"
      end
    end
  end

  def post_install
    # Run setup to install scripts and configure tmux
    # Copy scripts from libexec to ~/.local/bin
    home = Dir.home
    local_bin = File.join(home, ".local", "bin")
    FileUtils.mkdir_p(local_bin)

    FileUtils.cp(File.join(libexec, "tmux-mouse-toggle.sh"), File.join(local_bin, "claude-dashboard-mouse-toggle"))
    FileUtils.cp(File.join(libexec, "tmux-status-bar.sh"), File.join(local_bin, "claude-dashboard-status-bar"))
    FileUtils.chmod(0755, File.join(local_bin, "claude-dashboard-mouse-toggle"))
    FileUtils.chmod(0755, File.join(local_bin, "claude-dashboard-status-bar"))

    # Run setup to configure tmux
    system "#{bin}/claude-dashboard", "setup"
  end

  def caveats
    <<~EOS
      Setup was automatically run during installation.

      If you need to re-run setup:
        claude-dashboard setup

      This will:
      - Install helper scripts to ~/.local/bin/
      - Configure ~/.tmux.conf for F12 mouse toggle
      - Add status bar with version info

      To start using claude-dashboard:
        claude-dashboard
    EOS
  end
end
